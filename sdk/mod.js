import e from"fs";import t from"path";import{fileURLToPath as r}from"url";const s=r(import.meta.url),i=t.dirname(s);function n(r){let s;if(r.sdkConfig.appVersion||(r.sdkConfig.appVersion=function(){try{return JSON.parse(e.readFileSync(t.resolve(process.cwd(),"package.json"),"utf-8")).version}catch(e){console.warn("Failed to read version from package.json:",e)}if(process.env.PACKAGE_VERSION)return process.env.PACKAGE_VERSION;return"unknown"}()),fetch(`${r.sdkConfig.url}/createBuild`,{method:"POST",headers:{"Content-Type":"application/json","X-App-Id":r.sdkConfig.appId,"X-App-Key":r.sdkConfig.appKey},body:JSON.stringify({app_version:r.sdkConfig.appVersion})}).then((e=>{e.ok?e.json().then((e=>{r.sdkConfig.buildId=e.build_id})):console.error("Failed to add build to database:",e.status)})),!r.sdkConfig)throw new Error("sdkConfig is required");for(const e in r.sdkConfig)if(!r.sdkConfig[e])throw new Error(`sdkConfig is missing required field: ${e}`);return{name:"vite-plugin-fresk",configResolved(e){s=r.sourcemapDir||e.build.outDir},async buildStart(){const r=t.resolve(i,"../core/index.js"),s=await e.promises.readFile(r,"utf-8");this.emitFile({type:"asset",fileName:"fresk-sdk.js",source:s})},transformIndexHtml:()=>[{tag:"script",attrs:{type:"module"},children:`\n            import('./core/index.js').then(module => {\n              const FreskWebSDK = module.default;\n              \n              const freskSDK = new FreskWebSDK(${JSON.stringify(r.sdkConfig)});\n              freskSDK.init();\n              window.freskSDK = freskSDK;\n            });\n          `}],async writeBundle(){const i=e.readdirSync(s,{withFileTypes:!0}).flatMap((r=>r.isDirectory()?e.readdirSync(t.join(s,r.name)).filter((e=>e.endsWith(".map"))).map((e=>t.join(r.name,e))):r.name.endsWith(".map")?[r.name]:[]));for(const n of i){const i=t.join(s,n),o=e.readFileSync(i,"utf-8"),a={build_id:r.sdkConfig.buildId,file_name:n,map:JSON.parse(o)};fetch(`${r.sdkConfig.url}/addSourceMap`,{method:"POST",headers:{"Content-Type":"application/json","X-App-Id":r.sdkConfig.appId,"X-App-Key":r.sdkConfig.appKey},body:JSON.stringify(a)}).then((e=>{e.ok?e.json().then((e=>{console.log("Source map added to database:",e)})):console.error("Failed to add source map to database:",e.status)}))}if(r.deleteMapsAfterBuild)for(const r of i){const i=t.join(s,r);e.unlinkSync(i),console.log(`Deleted source map: ${i}`)}}}}const o={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},a={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},c={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},d={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},l={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};class u{static getFirstMatch(e,t){const r=t.match(e);return r&&r.length>0&&r[1]||""}static getSecondMatch(e,t){const r=t.match(e);return r&&r.length>1&&r[2]||""}static matchAndReturnConst(e,t,r){if(e.test(t))return r}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const t=e.split(".").splice(0,2).map((e=>parseInt(e,10)||0));if(t.push(0),10===t[0])switch(t[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const t=e.split(".").splice(0,2).map((e=>parseInt(e,10)||0));if(t.push(0),!(1===t[0]&&t[1]<5))return 1===t[0]&&t[1]<6?"Cupcake":1===t[0]&&t[1]>=6?"Donut":2===t[0]&&t[1]<2?"Eclair":2===t[0]&&2===t[1]?"Froyo":2===t[0]&&t[1]>2?"Gingerbread":3===t[0]?"Honeycomb":4===t[0]&&t[1]<1?"Ice Cream Sandwich":4===t[0]&&t[1]<4?"Jelly Bean":4===t[0]&&t[1]>=4?"KitKat":5===t[0]?"Lollipop":6===t[0]?"Marshmallow":7===t[0]?"Nougat":8===t[0]?"Oreo":9===t[0]?"Pie":void 0}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,t,r=!1){const s=u.getVersionPrecision(e),i=u.getVersionPrecision(t);let n=Math.max(s,i),o=0;const a=u.map([e,t],(e=>{const t=n-u.getVersionPrecision(e),r=e+new Array(t+1).join(".0");return u.map(r.split("."),(e=>new Array(20-e.length).join("0")+e)).reverse()}));for(r&&(o=n-Math.min(s,i)),n-=1;n>=o;){if(a[0][n]>a[1][n])return 1;if(a[0][n]===a[1][n]){if(n===o)return 0;n-=1}else if(a[0][n]<a[1][n])return-1}}static map(e,t){const r=[];let s;if(Array.prototype.map)return Array.prototype.map.call(e,t);for(s=0;s<e.length;s+=1)r.push(t(e[s]));return r}static find(e,t){let r,s;if(Array.prototype.find)return Array.prototype.find.call(e,t);for(r=0,s=e.length;r<s;r+=1){const s=e[r];if(t(s,r))return s}}static assign(e,...t){const r=e;let s,i;if(Object.assign)return Object.assign(e,...t);for(s=0,i=t.length;s<i;s+=1){const e=t[s];if("object"==typeof e&&null!==e){Object.keys(e).forEach((t=>{r[t]=e[t]}))}}return e}static getBrowserAlias(e){return o[e]}static getBrowserTypeByAlias(e){return a[e]||""}}const p=/version\/(\d+(\.?_?\d+)+)/i,h=[{test:[/googlebot/i],describe(e){const t={name:"Googlebot"},r=u.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,e)||u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/opera/i],describe(e){const t={name:"Opera"},r=u.getFirstMatch(p,e)||u.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opr\/|opios/i],describe(e){const t={name:"Opera"},r=u.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,e)||u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/SamsungBrowser/i],describe(e){const t={name:"Samsung Internet for Android"},r=u.getFirstMatch(p,e)||u.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Whale/i],describe(e){const t={name:"NAVER Whale Browser"},r=u.getFirstMatch(p,e)||u.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MZBrowser/i],describe(e){const t={name:"MZ Browser"},r=u.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,e)||u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/focus/i],describe(e){const t={name:"Focus"},r=u.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,e)||u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/swing/i],describe(e){const t={name:"Swing"},r=u.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,e)||u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/coast/i],describe(e){const t={name:"Opera Coast"},r=u.getFirstMatch(p,e)||u.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(e){const t={name:"Opera Touch"},r=u.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,e)||u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/yabrowser/i],describe(e){const t={name:"Yandex Browser"},r=u.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,e)||u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/ucbrowser/i],describe(e){const t={name:"UC Browser"},r=u.getFirstMatch(p,e)||u.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/Maxthon|mxios/i],describe(e){const t={name:"Maxthon"},r=u.getFirstMatch(p,e)||u.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/epiphany/i],describe(e){const t={name:"Epiphany"},r=u.getFirstMatch(p,e)||u.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/puffin/i],describe(e){const t={name:"Puffin"},r=u.getFirstMatch(p,e)||u.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sleipnir/i],describe(e){const t={name:"Sleipnir"},r=u.getFirstMatch(p,e)||u.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/k-meleon/i],describe(e){const t={name:"K-Meleon"},r=u.getFirstMatch(p,e)||u.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/micromessenger/i],describe(e){const t={name:"WeChat"},r=u.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,e)||u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/qqbrowser/i],describe(e){const t={name:/qqbrowserlite/i.test(e)?"QQ Browser Lite":"QQ Browser"},r=u.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,e)||u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/msie|trident/i],describe(e){const t={name:"Internet Explorer"},r=u.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/\sedg\//i],describe(e){const t={name:"Microsoft Edge"},r=u.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/edg([ea]|ios)/i],describe(e){const t={name:"Microsoft Edge"},r=u.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/vivaldi/i],describe(e){const t={name:"Vivaldi"},r=u.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/seamonkey/i],describe(e){const t={name:"SeaMonkey"},r=u.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/sailfish/i],describe(e){const t={name:"Sailfish"},r=u.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,e);return r&&(t.version=r),t}},{test:[/silk/i],describe(e){const t={name:"Amazon Silk"},r=u.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/phantom/i],describe(e){const t={name:"PhantomJS"},r=u.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/slimerjs/i],describe(e){const t={name:"SlimerJS"},r=u.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(e){const t={name:"BlackBerry"},r=u.getFirstMatch(p,e)||u.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(web|hpw)[o0]s/i],describe(e){const t={name:"WebOS Browser"},r=u.getFirstMatch(p,e)||u.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/bada/i],describe(e){const t={name:"Bada"},r=u.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/tizen/i],describe(e){const t={name:"Tizen"},r=u.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,e)||u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/qupzilla/i],describe(e){const t={name:"QupZilla"},r=u.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,e)||u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/firefox|iceweasel|fxios/i],describe(e){const t={name:"Firefox"},r=u.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/electron/i],describe(e){const t={name:"Electron"},r=u.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/MiuiBrowser/i],describe(e){const t={name:"Miui"},r=u.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/chromium/i],describe(e){const t={name:"Chromium"},r=u.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,e)||u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/chrome|crios|crmo/i],describe(e){const t={name:"Chrome"},r=u.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/GSA/i],describe(e){const t={name:"Google Search"},r=u.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test(e){const t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe(e){const t={name:"Android Browser"},r=u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/playstation 4/i],describe(e){const t={name:"PlayStation 4"},r=u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/safari|applewebkit/i],describe(e){const t={name:"Safari"},r=u.getFirstMatch(p,e);return r&&(t.version=r),t}},{test:[/.*/i],describe(e){const t=-1!==e.search("\\(")?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:u.getFirstMatch(t,e),version:u.getSecondMatch(t,e)}}}];var g=[{test:[/Roku\/DVP/],describe(e){const t=u.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,e);return{name:d.Roku,version:t}}},{test:[/windows phone/i],describe(e){const t=u.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,e);return{name:d.WindowsPhone,version:t}}},{test:[/windows /i],describe(e){const t=u.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,e),r=u.getWindowsVersionName(t);return{name:d.Windows,version:t,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(e){const t={name:d.iOS},r=u.getSecondMatch(/(Version\/)(\d[\d.]+)/,e);return r&&(t.version=r),t}},{test:[/macintosh/i],describe(e){const t=u.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,e).replace(/[_\s]/g,"."),r=u.getMacOSVersionName(t),s={name:d.MacOS,version:t};return r&&(s.versionName=r),s}},{test:[/(ipod|iphone|ipad)/i],describe(e){const t=u.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,e).replace(/[_\s]/g,".");return{name:d.iOS,version:t}}},{test(e){const t=!e.test(/like android/i),r=e.test(/android/i);return t&&r},describe(e){const t=u.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,e),r=u.getAndroidVersionName(t),s={name:d.Android,version:t};return r&&(s.versionName=r),s}},{test:[/(web|hpw)[o0]s/i],describe(e){const t=u.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,e),r={name:d.WebOS};return t&&t.length&&(r.version=t),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(e){const t=u.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,e)||u.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,e)||u.getFirstMatch(/\bbb(\d+)/i,e);return{name:d.BlackBerry,version:t}}},{test:[/bada/i],describe(e){const t=u.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,e);return{name:d.Bada,version:t}}},{test:[/tizen/i],describe(e){const t=u.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,e);return{name:d.Tizen,version:t}}},{test:[/linux/i],describe:()=>({name:d.Linux})},{test:[/CrOS/],describe:()=>({name:d.ChromeOS})},{test:[/PlayStation 4/],describe(e){const t=u.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,e);return{name:d.PlayStation4,version:t}}}],m=[{test:[/googlebot/i],describe:()=>({type:"bot",vendor:"Google"})},{test:[/huawei/i],describe(e){const t=u.getFirstMatch(/(can-l01)/i,e)&&"Nova",r={type:c.mobile,vendor:"Huawei"};return t&&(r.model=t),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:()=>({type:c.tablet,vendor:"Nexus"})},{test:[/ipad/i],describe:()=>({type:c.tablet,vendor:"Apple",model:"iPad"})},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:()=>({type:c.tablet,vendor:"Apple",model:"iPad"})},{test:[/kftt build/i],describe:()=>({type:c.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"})},{test:[/silk/i],describe:()=>({type:c.tablet,vendor:"Amazon"})},{test:[/tablet(?! pc)/i],describe:()=>({type:c.tablet})},{test(e){const t=e.test(/ipod|iphone/i),r=e.test(/like (ipod|iphone)/i);return t&&!r},describe(e){const t=u.getFirstMatch(/(ipod|iphone)/i,e);return{type:c.mobile,vendor:"Apple",model:t}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:()=>({type:c.mobile,vendor:"Nexus"})},{test:[/[^-]mobi/i],describe:()=>({type:c.mobile})},{test:e=>"blackberry"===e.getBrowserName(!0),describe:()=>({type:c.mobile,vendor:"BlackBerry"})},{test:e=>"bada"===e.getBrowserName(!0),describe:()=>({type:c.mobile})},{test:e=>"windows phone"===e.getBrowserName(),describe:()=>({type:c.mobile,vendor:"Microsoft"})},{test(e){const t=Number(String(e.getOSVersion()).split(".")[0]);return"android"===e.getOSName(!0)&&t>=3},describe:()=>({type:c.tablet})},{test:e=>"android"===e.getOSName(!0),describe:()=>({type:c.mobile})},{test:e=>"macos"===e.getOSName(!0),describe:()=>({type:c.desktop,vendor:"Apple"})},{test:e=>"windows"===e.getOSName(!0),describe:()=>({type:c.desktop})},{test:e=>"linux"===e.getOSName(!0),describe:()=>({type:c.desktop})},{test:e=>"playstation 4"===e.getOSName(!0),describe:()=>({type:c.tv})},{test:e=>"roku"===e.getOSName(!0),describe:()=>({type:c.tv})}],f=[{test:e=>"microsoft edge"===e.getBrowserName(!0),describe(e){if(/\sedg\//i.test(e))return{name:l.Blink};const t=u.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,e);return{name:l.EdgeHTML,version:t}}},{test:[/trident/i],describe(e){const t={name:l.Trident},r=u.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:e=>e.test(/presto/i),describe(e){const t={name:l.Presto},r=u.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test(e){const t=e.test(/gecko/i),r=e.test(/like gecko/i);return t&&!r},describe(e){const t={name:l.Gecko},r=u.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}},{test:[/(apple)?webkit\/537\.36/i],describe:()=>({name:l.Blink})},{test:[/(apple)?webkit/i],describe(e){const t={name:l.WebKit},r=u.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,e);return r&&(t.version=r),t}}];class b{constructor(e,t=!1){if(null==e||""===e)throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},!0!==t&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=u.find(h,(e=>{if("function"==typeof e.test)return e.test(this);if(e.test instanceof Array)return e.test.some((e=>this.test(e)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=u.find(g,(e=>{if("function"==typeof e.test)return e.test(this);if(e.test instanceof Array)return e.test.some((e=>this.test(e)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:t}=this.getOS();return e?String(t).toLowerCase()||"":t||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:t}=this.getPlatform();return e?String(t).toLowerCase()||"":t||""}parsePlatform(){this.parsedResult.platform={};const e=u.find(m,(e=>{if("function"==typeof e.test)return e.test(this);if(e.test instanceof Array)return e.test.some((e=>this.test(e)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=u.find(f,(e=>{if("function"==typeof e.test)return e.test(this);if(e.test instanceof Array)return e.test.some((e=>this.test(e)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return u.assign({},this.parsedResult)}satisfies(e){const t={};let r=0;const s={};let i=0;if(Object.keys(e).forEach((n=>{const o=e[n];"string"==typeof o?(s[n]=o,i+=1):"object"==typeof o&&(t[n]=o,r+=1)})),r>0){const e=Object.keys(t),r=u.find(e,(e=>this.isOS(e)));if(r){const e=this.satisfies(t[r]);if(void 0!==e)return e}const s=u.find(e,(e=>this.isPlatform(e)));if(s){const e=this.satisfies(t[s]);if(void 0!==e)return e}}if(i>0){const e=Object.keys(s),t=u.find(e,(e=>this.isBrowser(e,!0)));if(void 0!==t)return this.compareVersion(s[t])}}isBrowser(e,t=!1){const r=this.getBrowserName().toLowerCase();let s=e.toLowerCase();const i=u.getBrowserTypeByAlias(s);return t&&i&&(s=i.toLowerCase()),s===r}compareVersion(e){let t=[0],r=e,s=!1;const i=this.getBrowserVersion();if("string"==typeof i)return">"===e[0]||"<"===e[0]?(r=e.substr(1),"="===e[1]?(s=!0,r=e.substr(2)):t=[],">"===e[0]?t.push(1):t.push(-1)):"="===e[0]?r=e.substr(1):"~"===e[0]&&(s=!0,r=e.substr(1)),t.indexOf(u.compareVersions(i,r,s))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,t=!1){return this.isBrowser(e,t)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some((e=>this.is(e)))}}
/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */class w{static getParser(e,t=!1){if("string"!=typeof e)throw new Error("UserAgent should be a string");return new b(e,t)}static parse(e){return new b(e).getResult()}static get BROWSER_MAP(){return a}static get ENGINE_MAP(){return l}static get OS_MAP(){return d}static get PLATFORMS_MAP(){return c}}const y=process.env.npm_package_version||"unknown";class v{appId;appKey;appVersion;appEnvironment;appUrl;buildId;retryLimit;retryCount;browser;isHandlingError;constructor(e){for(const t in e)if(!e[t])throw new Error(`Config is missing required field: ${t}`);this.appId=e.appId,this.appKey=e.appKey,this.appUrl=e.url.endsWith("/")?e.url.slice(0,-1):e.url,this.appVersion=e.appVersion,this.appEnvironment=e.appEnvironment,this.buildId=e.buildId,this.retryLimit=5,this.retryCount=0,this.browser=w.getParser(window.navigator.userAgent),this.isHandlingError=!1}init(){this.hookErrors()}hookErrors(){if("undefined"==typeof window)return void console.error({message:"window is undefined",kind:"console_error",hint:"Fresk needs to be initialized on the client side."});window.onerror=this.handleUnhandledError.bind(this);const e=console.error;console.error=(...t)=>{this.handleConsoleError(...t),e.apply(console,t)}}identify(e){e&&e.includes("@")&&sessionStorage.setItem("session_email",e)}reset(){sessionStorage.removeItem("session_id"),sessionStorage.removeItem("session_email")}handleUnhandledError(e,t,r,s,i){this.pushError({message:e,url:t,line:r,column:s,stacktrace:i?i.stack:"",kind:"exception"})}handleConsoleError(...e){this.isHandlingError||(this.isHandlingError=!0,this.pushError({message:e.join(" "),kind:"console_error"}),this.isHandlingError=!1)}pushError(e){const t=this.createErrorPayload(e);this.sendToServer(t)}sendToServer(e){const t=()=>{fetch(`${this.appUrl}/sendError`,{method:"POST",headers:{"Content-Type":"application/json","X-App-Id":this.appId,"X-App-Key":this.appKey},body:JSON.stringify(e)}).then((e=>{if(!e.ok)return Promise.reject(new Error(`HTTP error! status: ${e.status}`));this.retryCount=0})).catch((e=>{this.logError(`Failed to send error: ${e.message}`),this.retryCount++,this.retryCount<this.retryLimit?setTimeout(t,1e3*this.retryCount):this.logError("Max retry attempts reached. Error not sent.")}))};t()}logError(e){console.warn("[FreskWebSDK]",e)}createErrorPayload(e){return{app_id:this.appId,app_version:this.appVersion,build_id:this.buildId,app_environment:this.appEnvironment,session_id:this.getSessionId(),session_email:this.getSessionEmail(),device_type:this.getDeviceType(),browser_name:this.getBrowserName(),browser_os:this.getBrowserOS(),browser_version:this.getBrowserVersion(),page_id:this.getPageId(window.location.href),page_url:window.location.href,screen_resolution:this.getScreenResolution(),viewport_size:this.getViewportSize(),memory_usage:this.getMemoryUsage(),network_type:this.getNetworkType(),language:this.getLanguage(),time_zone:this.getTimeZone(),referrer:document.referrer||null,performance_metrics:this.getPerformanceMetrics(),sdk_version:y,time:Date.now(),log_type:e.kind,value:e.message,stacktrace:e.stacktrace||"",custom:e.custom||null}}getPageId(e){return e.split("/").slice(3).join("/")||"/"}getSessionId(){return sessionStorage.getItem("session_id")||this.generateSessionId()}getSessionEmail(){return sessionStorage.getItem("session_email")||""}generateSessionId(){const e=crypto.randomUUID();return sessionStorage.setItem("session_id",e),e}getDeviceType(){return this.browser.getPlatform().type||"unknown"}getBrowserName(){return this.browser.getBrowser().name||"unknown"}getBrowserVersion(){return this.browser.getBrowser().version||"unknown"}getBrowserOS(){return this.browser.getOS().name||"unknown"}getScreenResolution(){return`${window.screen.width}x${window.screen.height}`}getViewportSize(){return`${window.innerWidth}x${window.innerHeight}`}getMemoryUsage(){return"memory"in performance?performance.memory.usedJSHeapSize:null}getNetworkType(){return"connection"in navigator&&navigator.connection.effectiveType?navigator.connection.effectiveType:"unknown"}getLanguage(){return navigator.language||"unknown"}getTimeZone(){return Intl.DateTimeFormat().resolvedOptions().timeZone||"unknown"}getPerformanceMetrics(){if("getEntriesByType"in performance){const e=performance.getEntriesByType("paint"),t=performance.getEntriesByType("navigation")[0],r={first_paint:e.find((({name:e})=>"first-paint"===e))?.startTime,first_contentful_paint:e.find((({name:e})=>"first-contentful-paint"===e))?.startTime,dom_load:t.domContentLoadedEventEnd-t.domContentLoadedEventStart,load_time:t.loadEventEnd-t.loadEventStart};return JSON.stringify(r)}return null}}export{n as FreskPluginVite,v as FreskWebSDK};
